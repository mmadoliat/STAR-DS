---
title: "Short Course on R Tools"
subtitle: "Develop your own professional R package"
title-slide-attributes:
  data-background-image: mu-bg.png
  data-background-size: stretch
  data-slide-number: none
format: 
  revealjs:
    transition: fade
    scrollable: true
---

# Outline {transition="slide"}

::: incremental
-   Why Build an R Package?
-   System Setup
-   Package Structure
-   Package States in R
-   Create a Package
-   Functions & Documentation
-   Writing Functions and Documenting
-   Build a Simple Package from Scratch
:::

## ğŸ“¦ R Packages: The Fundamental Unit

In R, the **fundamental unit of shareable code** is the **package**.

A package bundles together:

::: incremental
- ğŸ§‘â€ğŸ’» Code  
- ğŸ“Š Data  
- ğŸ“š Documentation  
- ğŸ§ª Tests  
:::

. . .

â¡ï¸ All in one place, easy to share with others.

## ğŸ“¦ You Already Use Packages!

If youâ€™re here, you already know how to work with packages:

::: incremental
- ğŸ“¥ Install a package from CRAN:  
  ```r
  install.packages("x")
 ```
- â–¶ï¸ Use a package in R:
  ```r
  library("x")
 ```
- â“ Get help on them with
  ```r
  package?x
  help(package = "x")
 ```
:::

## ğŸ¯ Goal of This Talk

This workshop is about moving from **using packages** â¡ï¸ to **developing your own**.

. . .

**Why?**

::: incremental
- ğŸš€ To share your code with others  
- ğŸ“¦ To make your code easy to install, use, and learn  
- â³ To save yourself time with conventions and structure
:::

# System Setup

Make sure you have:

::: incremental
-   ğŸ›  The latest version of **R**.
-   ğŸ›  The latest version of **RStudio**.
:::

::: {.fragment .fade-up}
**ğŸ“¦ Required Packages:**

Install the essential development tools:

``` r
install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
```
:::

## ğŸ“¦ Key Packages

::: incremental
-   **`devtools`**: Simplifies package development by wrapping complex workflows into easy commands

-   **`roxygen2`**: Generates documentation from special comments in your function code

-   **`testthat`**: Provides a framework for unit testing and ensures your functions work correctly and safely over time

-   **`knitr`**: Powers dynamic report generation and vignette building that integrates code, results, and text using R Markdown
:::

::: {.fragment .fade-up}
> ğŸ’¡ These tools help automate, test, document, and share your package like a pro.
:::

# Package Structure

## ğŸ§© Directory layout {auto-animate="true"}

``` text
  mypkg/
  â”œâ”€â”€ DESCRIPTION         # Package metadata
  â”œâ”€â”€ NAMESPACE           # Exported functions & imports
  â”œâ”€â”€ R/                  # Your R functions
  â””â”€â”€ man/                # Auto-generated documentation
```

::: {.fragment .fade-up}
> ğŸ’¡ **Tip:** Many folders in an R package are optional and included as needed.
:::

## ğŸ§© Directory layout {auto-animate="true"}

``` text
  mypkg/
  â”œâ”€â”€ DESCRIPTION         # Package metadata
  â”œâ”€â”€ NAMESPACE           # Exported functions & imports
  â”œâ”€â”€ R/                  # Your R functions
  â”œâ”€â”€ man/                # Auto-generated documentation
  â”œâ”€â”€ tests/              # Unit tests with testthat
  â”œâ”€â”€ vignettes/          # Long-form documentation (Rmd)
  â”œâ”€â”€ data/               # Data sets (.rda files)
  â””â”€â”€ inst/               # Installed files (e.g., app/, extdata/)
```

## ğŸ›  Package States in R {transition="zoom"}

R packages transition through five development states:

::: incremental
-   ğŸ—‚ï¸ **Source**: your raw package folder
-   ğŸ“¦ **Bundled**: compressed .tar.gz for sharing
-   ğŸ§± **Binary**: platform-specific precompiled version
-   ğŸ“š **Installed**: available in your R library
-   ğŸ§  **In-Memory**: actively loaded via library()
:::

::: {.fragment .fade-up}
> Understanding these states helps you manage installation, sharing, and usage workflows.
:::

## ğŸ—‚ï¸ Source Package {transition="zoom"}

A **source package** is just a folder with a specific structure:

-   `DESCRIPTION` file\
-   `R/` folder with `.R` files\
-   Optional: `man/`, `tests/`, `vignettes/`

::: {.fragment .fade-up}
> Itâ€™s editable and human-readable â€” your starting point for development.
:::

## ğŸ“¦ Bundled Package

A **bundled package** is a compressed `.tar.gz` file created from a source package.

-   Commonly called a **source tarball**
-   Created using `devtools::build()`
-   Platform-independent format for distribution

::: {.fragment .fade-up}
> It acts as a transportable unit â€” not directly usable until installed.
:::

## ğŸ§± Binary Package {transition="zoom"}

A **binary package** is a platform-specific compiled package:

-   Windows: `.zip`
-   macOS: `.tgz`
-   Created using `devtools::build(binary = TRUE)`

::: {.fragment .fade-up}
> Ideal for users without development tools â€” typically distributed by CRAN.
:::

## ğŸ“š Installed Package {transition="zoom"}

An **installed package** is one thatâ€™s been unpacked and placed into a library folder.

-   No longer a single file
-   Ready to be loaded into memory

::: {.fragment .fade-up}
> `install.packages()` or `devtools::install_*()` bring packages into this state.
:::

## ğŸ§  In-Memory Package {transition="zoom"}

An **in-memory** package is an installed package thatâ€™s been loaded into the R session.

-   Use `library(pkgname)` to load
-   Makes all exported functions and objects available

::: {.fragment .fade-up}
> Use `library()` to see loaded packages.
:::

## ğŸ” Transitioning Between States {transition="convex"}

![](images/package/install-load.png){fig-align="center" fig-alt="Screenshot of Pagerank" width="55%"}

## ğŸ“¦ Package vs. ğŸ“š Library

::: incremental
- **Package** â†’ bundle of code, data, docs, tests  
- **Library** â†’ directory on your computer that contains installed packages  
::: 

. . .

> ğŸ‘‰ Think of a library as a *bookshelf* full of packages.


## âš ï¸ Common Confusion

Itâ€™s common to hear people say:

> "I loaded the *dplyr library*."

. . .

But actually:

::: incremental
- **dplyr**  is a package 
- It lives inside a **library**  
- You load it with `library(dplyr)`  
:::

. . .

 > ğŸ‘‰ A **library** is just where packages live (a directory)

## ğŸ“š Multiple Libraries in R

::: incremental
- R allows you to have **multiple library paths** on your system  
- Each library contains a set of installed packages  
- Check active library paths with:
:::

. . .

```r
.libPaths()
# [1] "C:/Program Files/R/R-4.5.1/library"
- ğŸ” Exploring Installed Packages
 ```r
lapply(.libPaths(), list.dirs, recursive = FALSE, full.names = FALSE)
# [[1]] 
#  [1] "abind"   "ash"     "askpass"   "backports"  
#  [5] "base"    "base64enc" "bitops"   "boot"
```


## ğŸš« Avoid `library()` Inside Packages

Do not use `library()` or `require()` inside your package code

::: incremental
  - Packages declare dependencies via **DESCRIPTION** and **NAMESPACE**
 - `library()` is for scripts and interactive sessions, not for packages
::: 

. . .

Instead, use:

::: incremental
- Imports: in **DESCRIPTION**
- `@import` or `@importFrom` in **Roxygen2** comments
::: 

. . .

> âœ… This is one of the biggest mental shifts when moving from scripts to package development


# Create a Package

Before creating your R package, you need to choose a **name**.

::: {.fragment .fade-up}
> ğŸ§  This can be the hardest part of the process!
:::

## ğŸ“› Formal Naming Rules

A valid R package name must:

::: incremental
1.  Contain only **letters**, **numbers**, and **periods (`.`)**
2.  **Start with a letter**
3.  **Not end** with a period
:::

::: {.fragment .fade-up}
âŒ You **cannot** use:

-   Hyphens `-`
-   Underscores `_`
:::

## ğŸ” Naming Tips for Shared Packages

If you plan to share your package:

::: incremental
-   âœ… Choose a **unique** name that's easy to Google\
-   ğŸ” Avoid names already on **CRAN** or **Bioconductor**
-   âŒ¨ï¸ Stick to all **lowercase** â€” e.g., avoid `RGTK2` vs `RGtk2`
-   ğŸ—£ï¸ Prefer **pronounceable** names â€” easier to talk and think about
:::

## ğŸ§  Naming Patterns and Examples

Evocative Names:

::: incremental
-   `lubridate` â†’ makes **dates** easier\
-   `r2d3` â†’ tools for **D3 visualizations**\
-   `forcats` â†’ tools **for** working with **categorical** variables
:::

. . .

**Abbreviations**

::: incremental
-   `Rcpp` â†’ **R + C++**
-   `brms` â†’ Bayesian Regression Models using Stan
:::

## ğŸ› ï¸ Creating Your Package

Once you have a name, create the package using either:

::: incremental
-   `usethis::create_package("mypkg")`\
-   **RStudio UI**:\
    *File â†’ New Project â†’ New Directory â†’ R Package*
:::

::: {.fragment .fade-up}
ğŸ‘‰ Both options run the same function under the hood.
:::

## ğŸ“¦ What Gets Created?

::::::: columns
:::: {.column width="70%"}
::: incremental
-   `R/` folder â†’ for your function code\
-   `DESCRIPTION` file â†’ metadata\
-   `NAMESPACE` file â†’ exports/imports\
-   `mypkg.Rproj` â†’ RStudio project file\
-   `.Rbuildignore`, `.gitignore` â†’ build and Git helpers
:::
::::

:::: {.column width="30%"}
::: {.fragment .fade-up}
![](images/package/create_pkg.png){fig-align="center" fig-alt="Screenshot of Pagerank" width="90%"}
:::
::::
:::::::

## ğŸ“„ DESCRIPTION File {auto-animate="true"}

The `DESCRIPTION` file provides overall metadata about your package:

::: incremental
-   Package name and version\
-   Author and maintainer info\
-   Dependencies (`Imports`, `Suggests`)\
-   Description and license\
-   Build-related metadata
:::

## ğŸ§¾ Sample DESCRIPTION File {auto-animate="true"}

``` text
Package: Rfssa
Title: Functional Singular Spectrum Analysis
Version: 3.1.0
Authors@R: c(
    person("Hossein", "Haghbin", email = "haghbin@pgu.ac.ir", role = c("aut", "cre"), comment = c(ORCID = "0000-0001-8416-2354")),
    person("Mehdi", "Maadooliat", email = "mehdi.maadooliat@mu.edu", role = "aut", comment = c(ORCID = "0000-0002-5408-2676"))
    )
Maintainer: Hossein Haghbin <haghbin@pgu.ac.ir>
Description: Methods and tools for implementing functional singular spectrum analysis and related techniques.
License: GPL-3
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Depends: R (>= 4.0.0)
```

## More Details DESCRIPTION {auto-animate="true"}

``` text
Package: Rfssa
Title: Functional Singular Spectrum Analysis
Version: 3.1.0
Authors@R: c(
    person("Hossein", "Haghbin", email = "haghbin@pgu.ac.ir", role = c("aut", "cre"), comment = c(ORCID = "0000-0001-8416-2354")),
    person("Mehdi", "Maadooliat", email = "mehdi.maadooliat@mu.edu", role = "aut", comment = c(ORCID = "0000-0002-5408-2676"))
    )
Maintainer: Hossein Haghbin <haghbin@pgu.ac.ir>
Description: Methods and tools for implementing functional singular spectrum analysis and related techniques.
License: GPL-3
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
URL: https://github.com/haghbinh/Rfssa
LazyLoad: true
Imports: Rcpp,fda,lattice,plotly
LinkingTo: Rcpp, RcppArmadillo, RcppEigen,
Suggests: 
    knitr
Depends: R (>= 4.0.0)
```

## ğŸ“ Title vs. Description

**Title**

::: incremental
-   One line\
-   No punctuation or markup\
-   Capitalize like a title\
-   Keep under \~65 characters
:::

. . .

**Description**

::: incremental
-   One paragraph, plain text\
-   Multiple sentences OK\
-   Should describe what the package does
:::

## ğŸ§ª Example from `ggplot2`:

``` text
Title: Create Elegant Data Visualisations Using the Grammar of Graphics
Description: A system for 'declaratively' creating graphics,
  based on "The Grammar of Graphics". You provide the data,
  tell 'ggplot2' how to map variables to aesthetics, what
  graphical primitives to use, and it takes care of the details.
```

## ğŸ“¦ Imports vs. Suggests

**Imports**

::: incremental
-   Packages required at runtime
-   Automatically installed with your package
-   Needed for core functionality
:::

. . .

**Suggests**

::: incremental
-   Optional or development-time dependencies
-   Used in examples, tests, or vignettes
-   Not required to run the core package
:::

::: {.fragment .fade-up}
> Use `usethis::use_package("pkg", type = "Imports")` to manage these easily.
:::

## ğŸ“‚ NAMESPACE File

The `NAMESPACE` file defines the **interface** of your package.

It controls:

::: incremental
-   What functions your package **exports**
-   What functions it **imports** from other packages
-   S3/S4 method registrations (if needed)
:::

::: {.fragment .fade-up}
> This file is auto-generated by **roxygen2**, so you typically donâ€™t edit it by hand.
:::

## ğŸ§¾ Example: NAMESPACE File

``` text
# Generated by roxygen2: do not edit by hand
S3method("*", funts)
export(as.funts)
import(shiny)
importFrom(ggplot2, ggplot)
```

. . .

-   `export()` â€” makes a function available to users

-   `import()` â€” brings in all exported objects from a package

-   `importFrom()` â€” imports specific functions

-   `S3method()` â€” registers an S3 method

## âœï¸ How to Generate NAMESPACE 

In `.R` files:

```r
#' @export
r_func <- function(x) { ... }
```
. . .

In `.cpp` files:

```cpp
// [[Rcpp::export]]
double myRcpp-func(int x, double y) { ... }
```

# Functions & Documentation

To add functionality to your package, youâ€™ll write:

::: incremental
-   âœ… Functions â€” saved as `.R` scripts in the `R/` folder\
-   ğŸ“ Documentation â€” using **roxygen2** comments above each function
:::

::: {.fragment .fade-up}
> Letâ€™s walk through the process.
:::

## ğŸ“‚ Code Placement

All your functions go in the `R/` folder.

``` text
mypkg/
â”œâ”€â”€ R/
â”‚   â”œâ”€â”€ my_function.R
â”‚   â””â”€â”€ helpers.R
```

Each `.R` file can contain one or more functions.

## ğŸ“ Documenting Functions with Roxygen2

Use special comments starting with `#'` to write function documentation:

``` r
#' Sum of Square Function
#'
#' This function computes the Sum of Squares of a numeric vector
#' 
#' @param x Numeric vector
#' @return Numeric sum of x
#'
#' @examples
#' x <- 1:5
#' y <- my_function(x)
#' print(y)
#'
my_function <- function(x) sum(x^2)
```

This will generate help files in the **man/** folder.

## âš™ï¸ Generate Documentation

After writing your function and roxygen2 comments, run:

``` r
devtools::document()
```

This will:

::: incremental
-   Update the NAMESPACE file

-   Create `.Rd` help files in the man/ folder
:::

::: {.fragment .fade-up}
ğŸ’¡ You can also press `Ctrl+Shift+D` in RStudio.
:::

# Build a Simple Package from Scratch

## ğŸ§± Step 1: Create Your Package

Use `usethis` to create a new package directory:

``` r
usethis::create_package("minipkg")
```

This creates:

::: incremental
-   **R/, DESCRIPTION, NAMESPACE**

-   `.Rproj`, `.gitignore`, `.Rbuildignore`

-   Opens new RStudio project for your package
:::

## 2ï¸âƒ£ Add a Dataset

Letâ€™s include a built-in dataset (mtcars) for simplicity:

``` r
usethis::use_data(mtcars, overwrite = TRUE)
```
. . .

This creates a **data/mtcars.rda** file â€” accessible via

```r
minipkg::mtcars
```

## 3ï¸âƒ£ Create a Function

Create a new file: **R/summary_stats.R**

```{.r code-line-numbers="1-11|12-18" height="200"}
#' Compute Summary Statistics
#'
#' Returns mean and standard deviation for each numeric column.
#'
#' @param data A data frame with numeric columns
#' @return A data frame with `mean` and `sd` per column
#'
#' @examples
#' summary_stats(mtcars)
#'
#' @export
summary_stats <- function(data) {
  numeric_data <- data[sapply(data, is.numeric)]
  data.frame(
    mean = sapply(numeric_data, mean),
    sd = sapply(numeric_data, sd)
  )
}
```

## 4ï¸âƒ£ Document the Function

Run the following command to generate docs:

``` r
devtools::document()
```

This will:

::: incremental
-   Add `export(summary_stats)` to your **NAMESPACE**

-   Create **man/summary_stats.Rd**
:::

## 5ï¸âƒ£ Load and Test the Package

In the console:

``` r
devtools::load_all()
```

::: {.fragment .fade-up}
Then test the function:

``` r
summary_stats(mtcars)
```
:::

::: {.fragment .fade-up}
You should see:

``` text
                mean         sd
mpg        20.090625  6.0269481
cyl         6.187500  1.7859216
disp      230.721875 123.9386938
```
:::

## 6ï¸âƒ£ Build and Install the Package

Build the package locally:

``` r
devtools::build()
```

::: {.fragment .fade-up}
Install it:

``` r
devtools::install()
```
:::

::: {.fragment .fade-up}
Now you can use it like any other package:

``` r
library(minipkg)
summary_stats(mtcars)
```
:::

## ğŸš€ `help("summary_stats")` {transition="convex"}

![](images/package/help.png){fig-align="center" fig-alt="Screenshot of Pagerank" width="55%"}

# Hands-on Exercises (30 min)

::: incremental
1.  Create a new package skeleton and add a simple function
2.  Write roxygen docs and generate help files
:::

# Resources & Further Reading

-   **Books**: *R Packages* by Hadley Wickham (<https://r-pkgs.org>)
-   **devtools**: <https://devtools.r-lib.org>
-   **usethis**: helper functions
-   **CRAN Repository Policy**: CRAN manual

# ğŸ™ Thank you!

Questions & Discussion
